<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Medical Records</title>
    <!-- DataTables CSS -->
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.css">
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- DataTables JS -->
    <script type="text/javascript" charset="utf8"
        src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f4f8;
            margin: 0;
            padding: 20px;
            color: #333;
        }

        h1 {
            color: #333;
            margin-bottom: 30px;
            font-size: 28px;
            font-weight: 700;
            text-align: center;
        }

        /* Filter Section Styling */
        .filter-section {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 20px;
        }

        .filter-section select {
            padding: 8px;
            border-radius: 6px;
            border: 1px solid #ddd;
            outline: none;

        }

        .filter-section label {
            font-size: 14px;
            font-weight: bold;
            color: #333;
        }

        .filter-section select:focus {
            border-color: #1a73e8;
        }

        /* Table Section Styling */

        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 600px;
            background-color: #fff;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            border-radius: 8px;
            padding: 10px;
        }

        thead {
            position: sticky;
            top: 0;
            color: #fff;
        }

        th,
        td {

            text-align: center;
            border: 1px solid #ddd;
        }

        th {
            /* background-color: #1a73e8; */
            background-color: #333;
            color: #ffffff;
            text-transform: uppercase;
            font-weight: 600;
        }

        th:hover {
            background-color: #e3e0e0;
            color: #333;
            cursor: pointer;
        }

        tr:nth-child(even) {
            background-color: #f9fafb;
        }


        /* Responsive adjustments */
        @media (max-width: 768px) {
            table {
                min-width: 600px;
            }

            th,
            td {
                padding: 10px 12px;
                font-size: 12px;
            }
        }

        @media (max-width: 480px) {

            th,
            td {
                padding: 8px 10px;
                font-size: 11px;
            }

            th {
                font-size: 13px;
            }
        }
    </style>
</head>

<body>
    <h1>All Medical Records</h1>

    <!-- Filters Section -->
    <div class="filter-section">
        <div>
            <label for="pregnancyFilter">Pregnancy Status:</label>
            <select id="pregnancyFilter">
                <option value="">All</option>
                <option value="Yes">Pregnant</option>
                <option value="No">Non-Pregnant</option>
            </select>
        </div>

        <div>
            <label for="genderFilter">Gender:</label>
            <select id="genderFilter">
                <option value="">All</option>
                <option value="Male">Male</option>
                <option value="Female">Female</option>
            </select>
        </div>

        <div>
            <label for="diagnosisFilter">Diagnosis Result:</label>
            <select id="diagnosisFilter">
                <option value="">All</option>
                <option value="Positive">Positive</option>
                <option value="Negative">Negative</option>

            </select>
        </div>

        <div>
            <label for="treatmentFilter">Treatment:</label>
            <select id="treatmentFilter">
                <option value="">All</option>
                <option value="Sulfadoxime">Sulfadoxime</option>
                <option value="ACT">ACT</option>
                <option value="Artesunate">Artesunate</option>
                <option value="None">None</option>
                <option value="Other">Other</option>
            </select>
        </div>
        <div>
            <label for="itnFilter">ITN Result:</label>
            <select id="itnFilter">
                <option value="">All</option>
                <option value="Yes">Yes</option>
                <option value="No">No</option>
            </select>
        </div>
        <div>
            <label for="labFilter">Lab Result:</label>
            <select id="labFilter">
                <option value="">All</option>
                <option value="Microscopy">Microscopy</option>
                <option value="RDT">RDT</option>
                <option value="NoTestDone">No Test </option>
            </select>
        </div>
    </div>

    <div class="table-container">
        <table id="recordsTable" class="display">
            <thead>
                <tr>
                    <th>No</th>
                    <th>ID</th>
                    <th>Client</th>
                    <th>Age</th>
                    <th>Weight</th>
                    <th>Diagnosis</th>
                    <th>Lab Investigation</th>
                    <th>Treatment</th>
                    <th>Pregnancy</th>
                    <th>Gender</th>
                    <th>Outcome</th>
                    <th>ITN</th>
                    <th>Email</th>
                </tr>
            </thead>
            <tbody>
                <% let number=0; %>
                    <% data.forEach(item=> { %>
                        <tr>
                            <td>
                                <%= ++number %>
                            </td>
                            <td>
                                <%= item._id %>
                            </td>
                            <td>
                                <%= item.client %>
                            </td>
                            <td>
                                <%= item.age %>
                            </td>
                            <td>
                                <%= item.weight %>
                            </td>
                            <td>
                                <%= item.diagnosis %>
                            </td>
                            <td>
                                <%= item.lab_investigation %>
                            </td>
                            <td>
                                <%= item.treatment %>
                            </td>
                            <td>
                                <%= item.pregnant %>
                            </td>
                            <td>
                                <%= item.sex %>
                            </td>
                            <td>
                                <%= item.outcome_visit %>
                            </td>
                            <td>
                                <%= item.itn %>
                            </td>
                            <td>
                                <%= item.email %>
                            </td>
                        </tr>
                        <% }); %>
            </tbody>
        </table>
    </div>

    <!-- Initialize DataTables with custom filters -->
    <script>
        $(document).ready(function () {
            // Initialize DataTable with pagination, search, and ordering
            var table = $('#recordsTable').DataTable({
                "pageLength": 20,  // Set the default number of rows per page
                "searching": true, // Enable searching
                "ordering": true,  // Enable column ordering
                "lengthChange": true, // Allow users to change page length
                "columnDefs": [
                    { "targets": [1, 2, 5, 6, 7, 8, 9, 11, 12], "searchable": true }, // searching for ID column
                    { "targets": [1, 2, 3, 4, 5, 6, 7, 8, 9, 11], "orderable": false }   // Disable sorting for ID column
                ]
            });

            /**
             * Custom filter logic based on dropdown selections.
             * It filters based on Pregnancy Status, Gender, Diagnosis, and Treatment fields.
             * We ensure the filter values match what's in the table, case insensitively.
             */
            $.fn.dataTable.ext.search.push(function (settings, data, dataIndex) {
                // Get selected filter values
                var pregnancyStatus = $('#pregnancyFilter').val().toLowerCase();
                var gender = $('#genderFilter').val().toLowerCase();
                var diagnosis = $('#diagnosisFilter').val().toLowerCase();
                var treatment = $('#treatmentFilter').val().toLowerCase();
                var lab = $('#labFilter').val().toLowerCase();
                var itn = $('#itnFilter').val().toLowerCase();

                // Get actual data from the row
                var pregnancy = data[8].toLowerCase();
                var patientGender = data[9].toLowerCase();
                var patientDiagnosis = data[5].toLowerCase();
                var patientTreatment = data[7].toLowerCase();
                var labInvestigation = data[6].toLowerCase();
                var itnCount = data[11].toLowerCase();


                if ((pregnancyStatus === '' || pregnancy === pregnancyStatus) &&
                    (gender === '' || patientGender === gender) &&
                    (diagnosis === '' || patientDiagnosis === diagnosis) &&
                    (treatment === '' || patientTreatment === treatment) &&
                    (lab === '' || labInvestigation === lab) &&
                    (itn === '' || itnCount === itn)
                ) {
                    return true; // Row matches filter conditions
                }

                return false; // Row does not match, so it's filtered out
            });

            // Attach filter event listeners to reapply the filters whenever dropdowns change
            $('#pregnancyFilter, #genderFilter, #diagnosisFilter, #treatmentFilter, #labFilter, #itnFilter').on('change', function () {
                table.draw(); // Redraw the table to apply the filters
            });
        });
    </script>
</body>

</html>



